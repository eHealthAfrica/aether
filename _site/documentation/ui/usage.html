<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether - Basic Usage</title>
    <link  charset="utf-8"  media="screen"  type="text/css" href="/css/index.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/images/aux-icon.png"/>
  </head>


  <body role="document" class="support">
    <nav class="navbar" role="navigation">
  <a class="logo" href="/index.html">Aether</a>
  <ul class="nav navbar__nav">
    <li class="nav-item__about"><a href="/index.html">About Aether</a></li>
    <li class="nav-item__support"><a href="/support.html">Support</a></li>
    <li class="nav-item__contact"><a href="/contact.html">Contact</a></li>
    <li class="navbar-button"><a class="btn" href="/demo.html">Watch demos</a></li>
  </ul>
</nav>
    
    

    <div id="content" class="content">
      <div id="top"></div>
      
    <div class="documentation">
  <div class="dropdown doc-nav-mobile">
    <a id="dropdownMenu2" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
      
        
          
        
          
        
      
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
      
        
          
        
          
        
          
        
          
        
          
        
      
      
      <span class="caret"></span>
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
      <li><a href="/support.html">Welcome</a></li>
    
      <li class="doc-nav-title">Introduction to Aether</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Try It For Yourself</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/try/index.html">Spin Up a Local Instance</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/connect.html">Adding Aether Connect</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Setup and Deployment Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/cloud-deployment.html">Cloud Installation</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/security.html">Security</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/user-management.html">User Management</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/aether-connect.html">Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/monitoring-troubleshooting.html">Monitoring and Troubleshooting</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/upgrading.html">Upgrading Aether</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Aether UI User Guide</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Working with Aether Consumers</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/consumers/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/consumers/ckan.html">CKAN Consumer</a>
            </li>
          
            <li class="">
              <a href="/documentation/consumers/elastic-search.html">Elastic Search Consumer</a>
            </li>
          
        </ul>
    
      <li class="doc-nav-title">Aether for Developers</li>
        <ul class="">
          
            <li class="">
              <a href="/documentation/developers/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/standards.html">Standards and Best Practices for Development</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/github.html">Github Processes</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/api.html">API Guide</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/more.html">More Developer Docs...</a>
            </li>
          
        </ul>
    
    </ul>
  </div>

  <div class="doc-nav">
    <a href="/support.html">Welcome</a>
    
      <a href="/documentation/introduction/index.html"><h3 class="doc-nav-title">Introduction to Aether</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/introduction/index.html">What is Aether?</a>
            </li>
          
            <li class="">
              <a href="/documentation/introduction/deeper.html">A Deeper Dive</a>
            </li>
          
        </ul>
    
      <a href="/documentation/try/index.html"><h3 class="doc-nav-title">Try It For Yourself</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/try/index.html">Spin Up a Local Instance</a>
            </li>
          
            <li class="">
              <a href="/documentation/try/connect.html">Adding Aether Connect</a>
            </li>
          
        </ul>
    
      <a href="/documentation/setup-deployment/index.html"><h3 class="doc-nav-title">Setup and Deployment Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/setup-deployment/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/cloud-deployment.html">Cloud Installation</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/security.html">Security</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/user-management.html">User Management</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/aether-connect.html">Aether Connect</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/monitoring-troubleshooting.html">Monitoring and Troubleshooting</a>
            </li>
          
            <li class="">
              <a href="/documentation/setup-deployment/upgrading.html">Upgrading Aether</a>
            </li>
          
        </ul>
    
      <a href="/documentation/ui/index.html"><h3 class="doc-nav-title">Aether UI User Guide</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/ui/index.html">Basic Concepts</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-intro.html">Introduction to the Interface</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-input.html">Define your pipeline input</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-output.html">Model your pipeline output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-mapping.html">Map the input to your output</a>
            </li>
          
            <li class="">
              <a href="/documentation/ui/pipeline-publish.html">Publish your pipeline</a>
            </li>
          
        </ul>
    
      <a href="/documentation/consumers/index.html"><h3 class="doc-nav-title">Working with Aether Consumers</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/consumers/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/consumers/ckan.html">CKAN Consumer</a>
            </li>
          
            <li class="">
              <a href="/documentation/consumers/elastic-search.html">Elastic Search Consumer</a>
            </li>
          
        </ul>
    
      <a href="/documentation/developers/index.html"><h3 class="doc-nav-title">Aether for Developers</h3></a>
        <ul class="">
          
            <li class="">
              <a href="/documentation/developers/index.html">Introduction</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/standards.html">Standards and Best Practices for Development</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/github.html">Github Processes</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/api.html">API Guide</a>
            </li>
          
            <li class="">
              <a href="/documentation/developers/more.html">More Developer Docs...</a>
            </li>
          
        </ul>
    
  </div>
  <div class="doc-content">

    <h1 id="basic-usage-of-aether">Basic usage of Aether</h1>

<h2 id="usage">Usage</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">--build</span>    <span class="c"># this will update the containers if needed</span>
</code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/docker_start.sh    <span class="c"># starts all</span>
</code></pre></div></div>

<p>This will start:</p>

<ul>
  <li>
    <p><strong>Aether Kernel</strong> on <code class="highlighter-rouge">http://kernel.aether.local:8000</code>
and create a superuser <code class="highlighter-rouge">admin-kernel</code> with the needed TOKEN.</p>
  </li>
  <li>
    <p><strong>Aether ODK Module</strong> on <code class="highlighter-rouge">http://odk.aether.local:8443</code>
and create a superuser <code class="highlighter-rouge">admin-odk</code> with the needed TOKEN.</p>
  </li>
  <li>
    <p><strong>Aether CouchDB Sync Module</strong> on <code class="highlighter-rouge">http://sync.aether.local:8666</code>
and create a superuser <code class="highlighter-rouge">admin-sync</code>.</p>
  </li>
</ul>

<p>All the created superusers have password <code class="highlighter-rouge">adminadmin</code> in each container.</p>

<p>To start any app/module separately:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/docker_start.sh kernel          <span class="c"># starts Aether Kernel app and its dependencies</span>

./scripts/docker_start.sh odk             <span class="c"># starts Aether ODK module and its dependencies</span>

./scripts/docker_start.sh couchdb-sync    <span class="c"># starts Aether CouchDB Sync module and its dependencies</span>
</code></pre></div></div>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h3 id="users--authentication">Users &amp; Authentication</h3>

<p>The app defers part of the users management to
<a href="https://github.com/eHealthAfrica/ums">eHA UMS tool</a>.</p>

<p>Set the <code class="highlighter-rouge">HOSTNAME</code> and <code class="highlighter-rouge">CAS_SERVER_URL</code> environment variables if you want to
activate the UMS integration in each container.</p>

<h4 id="ums-settings-for-local-development">UMS settings for local development</h4>

<p>The project is <code class="highlighter-rouge">aether-all</code> <strong>Aether Suite</strong>.</p>

<p>The client services are:</p>

<ul>
  <li><strong>Aether Kernel (local)</strong> for <code class="highlighter-rouge">kernel.aether.local</code>.</li>
  <li><strong>Aether ODK (local)</strong>  for <code class="highlighter-rouge">odk.aether.local</code>.</li>
  <li><strong>Aether Sync (local)</strong> for <code class="highlighter-rouge">sync.aether.local</code>.</li>
</ul>

<p>Other options are to log in via token, via basic authentication or via the
standard django authentication process in the admin section.
The available options depend on each container.</p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h4 id="token-authentication">Token Authentication</h4>

<p>The communication between the containers is done via
<a href="http://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">token authentication</a>.</p>

<p>In the case of <code class="highlighter-rouge">aether-odk-module</code> and <code class="highlighter-rouge">aether-couchdb-sync-module</code> there is a
global token to connect to <code class="highlighter-rouge">aether-kernel</code> set in the <strong>required</strong> environment
variable <code class="highlighter-rouge">AETHER_KERNEL_TOKEN</code>.</p>

<p>In the case of <code class="highlighter-rouge">aether-ui</code> there are tokens per user. This means that every time
a logged in user tries to visit any page that requires to fetch data from any of
the other apps, <code class="highlighter-rouge">aether-kernel</code> and/or <code class="highlighter-rouge">aether-odk-module</code>, the system will verify
that the user token for that app is valid or will request a new one using the
global tokens, <code class="highlighter-rouge">AETHER_KERNEL_TOKEN</code> and/or <code class="highlighter-rouge">AETHER_ODK_TOKEN</code>; thatâ€™s going to
be used for all requests and will allow the system to better track the user actions.</p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h2 id="containers-and-services">Containers and services</h2>

<p>The list of the main containers:</p>

<table>
  <thead>
    <tr>
      <th>Container</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>db</td>
      <td><a href="https://www.postgresql.org/">PostgreSQL</a> database</td>
    </tr>
    <tr>
      <td>couchdb</td>
      <td><a href="http://couchdb.apache.org/">CouchDB</a> database for sync</td>
    </tr>
    <tr>
      <td>redis</td>
      <td><a href="https://redis.io/">Redis</a> for task queueing and task result storage</td>
    </tr>
    <tr>
      <td><strong>kernel</strong></td>
      <td>Aether Kernel</td>
    </tr>
    <tr>
      <td><strong>odk</strong></td>
      <td>Aether ODK module (imports data from ODK Collect)</td>
    </tr>
    <tr>
      <td><strong>couchdb-sync</strong></td>
      <td>Aether CouchDB Sync module (imports data from Aether Mobile app)</td>
    </tr>
    <tr>
      <td>couchdb-sync-rq</td>
      <td><a href="http://python-rq.org/">RQ python</a> task runner to perform sync jobs</td>
    </tr>
    <tr>
      <td>kernel-test</td>
      <td>Aether Kernel TESTING app (used only in e2e tests by other containers)</td>
    </tr>
  </tbody>
</table>

<p>All of the containers definition for development can be found in the
<a href="docker-compose-base.yml">docker-compose-base.yml</a> file.</p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h2 id="run-commands-in-the-containers">Run commands in the containers</h2>

<p>Each docker container uses the same script as entrypoint. The <code class="highlighter-rouge">entrypoint.sh</code>
script offers a range of commands to start services or run commands.
The full list of commands can be seen in the script.</p>

<p>The pattern to run a command is always
<code class="highlighter-rouge">docker-compose run &lt;container-name&gt; &lt;entrypoint-command&gt; &lt;...args&gt;</code></p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h3 id="run-tests">Run tests</h3>

<p>This will stop ALL running containers and execute the containers tests.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/test_all.sh
</code></pre></div></div>

<p>To execute tests in just one container.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run &lt;container-name&gt; <span class="nb">test</span>

</code></pre></div></div>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run &lt;container-name&gt; test_lint
docker-compose run &lt;container-name&gt; test_coverage
</code></pre></div></div>

<p>The e2e tests are run against different containers, the config file used
for them is <a href="docker-compose-test.yml">docker-compose-test.yml</a>.</p>

<p>Before running <code class="highlighter-rouge">odk</code> or <code class="highlighter-rouge">couchdb-sync</code> you should start the needed test containers.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nt">-f</span> docker-compose-test.yml up <span class="nt">-d</span> &lt;container-name&gt;-test
</code></pre></div></div>

<p>This script will start the auxiliary containers and execute the tests
in <code class="highlighter-rouge">odk</code> or <code class="highlighter-rouge">couchdb-sync</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/test_with_kernel.sh &lt;container-name&gt;
</code></pre></div></div>

<p><strong>WARNING</strong></p>

<p>Never run <code class="highlighter-rouge">odk</code> or <code class="highlighter-rouge">couchdb-sync</code> tests against any PRODUCTION server.
The tests clean up will <strong>DELETE ALL MAPPINGS!!!</strong></p>

<p>Look into <a href="docker-compose-base.yml">docker-compose-base.yml</a>, the variable
<code class="highlighter-rouge">AETHER_KERNEL_URL_TEST</code> indicates the Aether Kernel Server used in tests.</p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>

<h3 id="upgrade-python-dependencies">Upgrade python dependencies</h3>

<h4 id="check-outdated-dependencies">Check outdated dependencies</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run &lt;container-name&gt; <span class="nb">eval </span>pip list <span class="nt">--outdated</span>
</code></pre></div></div>

<h4 id="update-requirements-file">Update requirements file</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/upgrade_all.sh
</code></pre></div></div>

<p>This also rebuilds <code class="highlighter-rouge">aether.common</code> module and distributes it within the containers.
Do not forget to include new containers in the file.</p>

<p>or</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose run &lt;container-name&gt; pip_freeze
</code></pre></div></div>

<p>In this case <code class="highlighter-rouge">aether.common</code> is not rebuilt.</p>

<p><em><a href="#table-of-contents">Return to TOC</a></em></p>


  </div>

</div>




    <div class="footer">
  <div class="social-links">
    <div class="email"><a href="mailto:solutions@ehealthafrica.org" target="_blank">solutions@ehealthafrica.org</a></div>
    <div class="facebook"><a href="https://www.facebook.com/EHealthAfrica" target="_blank"></a></div>
    <div class="twitter"><a href="https://twitter.com/eHealth_africa" target="_blank"></a></div>
    <div class="instagram"><a href="https://www.instagram.com/ehealthafrica/" target="_blank"></a></div>
    <div class="linkedin"><a href="https://www.linkedin.com/company/ehealth-&-information-systems-nigeria/" target="_blank"></a></div>
    <div class="youtube"><a href="https://www.youtube.com/channel/UCcgM_HhTcg5M9Ji3Of6QmUg" target="_blank"></a></div>
  </div>
  <a class="footer__logo" href="http://ehealthafrica.org" target="_blank">eHealth Africa</a>
</div>
      
    </div>
    <a href="#top" class="top circle-button-up"><i class="angle-right"></i></a>





        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-2.1.4.min.js"></script>
    <script src="/js/navbar.js"></script>
    <script src="/js/dropdown.js"></script>
    <script src="/js/input.js"></script>

  </body>

</html>
