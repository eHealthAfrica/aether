[
  {
    "name": "couchdb-sync",
    "image": "${image_url}",
    "cpu": 1,
    "memory": 256,
    "essential": true,
    "command": ["start"],
    "entryPoint": ["/code/entrypoint.sh"],
    "links": [
      "couchdb",
      "redis"
    ],
    "mountPoints": [
      {
        "sourceVolume": "static-couchdb-sync",
        "containerPath": "/var/www/static"
      }
    ],
    "environment": [
      { "name": "RDS_HOSTNAME", "value": "${database_hostname}"},
      { "name": "RDS_USERNAME", "value": "${database_user}"},
      { "name": "RDS_PASSWORD", "value": "${database_password}"},
      { "name": "RDS_PORT", "value": "${database_port}"},
      { "name": "RDS_DB_NAME", "value": "couchdb_sync"},
      { "name": "STATIC_ROOT", "value": "/var/www/static"},
      { "name": "DJANGO_USE_X_FORWARDED_PORT", "value": "${django_use_x_forwarded_port}"},
      { "name": "DJANGO_HTTP_X_FORWARDED_PROTO", "value": "${django_http_x_forwarded_proto}"},
      { "name": "DJANGO_USE_X_FORWARDED_HOST", "value": "${django_use_x_forwarded_host}"},
      { "name": "COUCHDB_URL", "value": "http://couchdb:5984"},
      { "name": "COUCHDB_USER", "value": "admin"},
      { "name": "COUCHDB_PASSWORD", "value": "${couchdb_password}"},
      { "name": "GOOGLE_CLIENT_ID", "value": "${google_client_id}"},
      { "name": "AETHER_CORE_URL", "value": "${aether_core_url}"},
      { "name": "AETHER_CORE_TOKEN", "value": "${aether_token}"},
      { "name": "REDIS_HOST", "value": "redis"},
      { "name": "REDIS_PORT", "value": "6379"},
      { "name": "REDIS_DATABASE", "value": "0"},
      { "name": "AWS_KEY", "value": "${aws_key}"},
      { "name": "AWS_SECRET_KEY", "value": "${aws_secret_key}"},
      { "name": "SENTRY_DSN", "value": "${sentry_dsn}"}
    ]
  },
  {
    "name": "couchdb-sync-worker",
    "image": "${image_url}",
    "cpu": 1,
    "memory": 512,
    "essential": true,
    "entryPoint": ["/code/entrypoint.sh"],
    "command": ["start_rq"],
    "links": [
      "couchdb",
      "redis"
    ],
    "environment": [
      { "name": "RDS_HOSTNAME", "value": "${database_hostname}"},
      { "name": "RDS_USERNAME", "value": "${database_user}"},
      { "name": "RDS_PASSWORD", "value": "${database_password}"},
      { "name": "RDS_PORT", "value": "${database_port}"},
      { "name": "RDS_DB_NAME", "value": "couchdb_sync"},
      { "name": "STATIC_ROOT", "value": "/var/www/static"},
      { "name": "DJANGO_USE_X_FORWARDED_PORT", "value": "${django_use_x_forwarded_port}"},
      { "name": "DJANGO_HTTP_X_FORWARDED_PROTO", "value": "${django_http_x_forwarded_proto}"},
      { "name": "DJANGO_USE_X_FORWARDED_HOST", "value": "${django_use_x_forwarded_host}"},
      { "name": "COUCHDB_URL", "value": "http://couchdb:5984"},
      { "name": "COUCHDB_USER", "value": "admin"},
      { "name": "COUCHDB_PASSWORD", "value": "${couchdb_password}"},
      { "name": "GOOGLE_CLIENT_ID", "value": "${google_client_id}"},
      { "name": "AETHER_CORE_URL", "value": "${aether_core_url}"},
      { "name": "AETHER_CORE_TOKEN", "value": "${aether_token}"},
      { "name": "REDIS_HOST", "value": "redis"},
      { "name": "REDIS_PORT", "value": "6379"},
      { "name": "REDIS_DATABASE", "value": "0"}
    ]
  },
  {
    "name": "couchdb-sync-nginx",
    "image": "${nginx_image_url}",
    "cpu": 1,
    "memory": 128,
    "essential": true,
    "portMappings": [
      {
        "containerPort": 80
      }
    ],
    "mountPoints": [
      {
        "sourceVolume": "static-couchdb-sync",
        "containerPath": "/var/www/static"
      }
    ],
    "links": [
      "couchdb",
      "couchdb-sync"
    ]
  },
  {
    "name": "couchdb",
    "image": "${couchdb_image_url}",
    "cpu": 1,
    "memory": 256,
    "essential": true,
    "environment": [
      { "name": "COUCHDB_USER", "value": "admin"},
      { "name": "COUCHDB_PASSWORD", "value": "${couchdb_password}"}
    ],
    "mountPoints": [
      {
        "sourceVolume": "couchdb-data",
        "containerPath": "/usr/local/var/lib/couchdb"
      }
    ]
  },
  {
    "name": "redis",
    "image": "redis:3.2",
    "cpu": 1,
    "memory": 256,
    "essential": true,
    "mountPoints": [
      {
        "sourceVolume": "redis-data",
        "containerPath": "/data"
      }
    ]
  }
]
